<?xml version="1.0"?>

<!-- For more information on using web.config transformation visit http://go.microsoft.com/fwlink/?LinkId=125889 -->

<configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform">

  <connectionStrings>
    <add name="Rentler.Data.RentlerContext"
         connectionString="Server=tcp:ojcqrdf9an.database.windows.net,1433;Database=Rentler.Data.RentlerContext;User ID=RentlerAdmin@ojcqrdf9an;Password=7h3r3n73r!;Trusted_Connection=False;Encrypt=True;Connection Timeout=30;"
         xdt:Transform="SetAttributes" xdt:Locator="Match(name)" />
  </connectionStrings>

  <appSettings>
    <add key="GoogleCode" value="UA-24851161-1" xdt:Transform="Replace" xdt:Locator="Match(key)" />
    <add key="AddThisPubId" value="ra-4e495ef7138737dd" xdt:Transform="Replace" xdt:Locator="Match(key)" />

    <!-- Caching configuration -->
    <add key="L1CacheEnabled" value="true" xdt:Transform="Replace" xdt:Locator="Match(key)" />

    <!-- Redis configuration for l2 caching -->
    <add key="RedisHost" value="rentlerredis.cloudapp.net" xdt:Transform="Replace" xdt:Locator="Match(key)" />
    <add key="RedisAuth" value="fckgwrhqq2yxrkt8tg6w2b7q8T33mp4ss" xdt:Transform="Replace" xdt:Locator="Match(key)" />
    <add key="RedisPort" value="6379" xdt:Transform="Replace" xdt:Locator="Match(key)" />
    <add key="RedisDatabase" value="1" xdt:Transform="Replace" xdt:Locator="Match(key)" />

    <add key="Hostname" value="https://www.rentler.com" xdt:Transform="Replace" xdt:Locator="Match(key)" />

    <!-- Azure Blob Images -->
    <add key="BlobPrefix" value="" xdt:Transform="Replace" xdt:Locator="Match(key)" />
  </appSettings>

  <system.web>
    <compilation xdt:Transform="RemoveAttributes(debug)" />

    <healthMonitoring enabled="true" xdt:Transform="Replace">
      <eventMappings>
        <clear />
        <add name="All Errors" type="System.Web.Management.WebBaseErrorEvent" startEventCode="0" endEventCode="2147483647" />
      </eventMappings>
      <providers>
        <clear />
        <add type="System.Web.Management.SimpleMailWebEventProvider" name="EmailWebEventProvider" from="developers@rentler.com" to="Developers@rentler.com" buffer="false" />
      </providers>
      <rules>
        <clear />
        <add name="All Errors Default" eventName="All Errors" provider="EmailWebEventProvider" profile="Default" minInstances="1" maxLimit="Infinite" minInterval="00:00:10" />
      </rules>
    </healthMonitoring>
  </system.web>

  <system.webServer>
    <httpErrors existingResponse="Replace" xdt:Transform="Replace">
      <remove statusCode="500" subStatusCode="-1" />
      <remove statusCode="404" subStatusCode="-1" />
      <remove statusCode="403" subStatusCode="-1" />
      <error statusCode="404" prefixLanguageFilePath="" path="/error/404.htm" responseMode="File" />
      <error statusCode="403" prefixLanguageFilePath="" path="/error/403.htm" responseMode="File" />
      <error statusCode="500" prefixLanguageFilePath="" path="/error/500.htm" responseMode="File" />
    </httpErrors>

    <rewrite>
      <rules>
        <rule name="Redirect HTTP to HTTPS" stopProcessing="true">
          <match url="(.*)"/>
          <conditions>
            <add input="{HTTPS}" pattern="^OFF$"/>
          </conditions>
          <action type="Redirect" url="https://www.rentler.com/{R:1}" redirectType="Permanent"/>
        </rule>
        <rule name="Redirect to www subdomain" stopProcessing="true">
          <match url=".*" />
          <conditions logicalGrouping="MatchAny">
            <add input="{HTTP_HOST}" pattern="^(www\.)(.*)$" negate="true" />
          </conditions>
          <action type="Redirect" url="https://www.{HTTP_HOST}/{R:0}" redirectType="Permanent" />
        </rule>
      </rules>
    </rewrite>

    <system.net>
      <mailSettings>
        <smtp deliveryMethod="Network" from="info@rentler.com">
          <network defaultCredentials="false"
                   host="smtp.sendgrid.net"
                   port="587"
                   enableSsl="true"
                   userName="Rentler"
                   password="T33mp4ssdyfmw" />
        </smtp>
      </mailSettings>
    </system.net>
  </system.webServer>

</configuration>